# Etapa de construção (builder)
FROM debian:rc-buggy-20250317 AS builder

WORKDIR /app

# Copia os arquivos da aplicação
COPY app.py .  
COPY templates templates/  
COPY static static/  

# Cria um arquivo de dependências corretamente
RUN echo "Flask\nredis\nprometheus_client" > requirements.txt

# Etapa final (runtime)
FROM python:3.12-slim 

WORKDIR /app

# Instala pip antes de instalar dependências
RUN apt-get update && apt-get install -y python3-pip && rm -rf /var/lib/apt/lists/*

# Copia os arquivos da aplicação e requirements.txt
COPY --from=builder /app /app

# Instala dependências corretamente
RUN pip install --no-cache-dir -r /app/requirements.txt

# Define o comando de execução correto
CMD ["python3", "/app/app.py"]

